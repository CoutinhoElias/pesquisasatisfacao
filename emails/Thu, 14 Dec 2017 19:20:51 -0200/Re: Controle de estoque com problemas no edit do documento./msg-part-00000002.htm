<div dir="ltr"><div class="gmail_default" style="font-family:tahoma,sans-serif;font-size:small">Talvez um método no modelo do Papel que, atualize a quantidade de estoque resolva o problema. </div><div class="gmail_default" style="font-family:tahoma,sans-serif;font-size:small"><br></div><div class="gmail_default" style="font-family:tahoma,sans-serif;font-size:small">Abraço!</div><div class="gmail_default" style="font-family:tahoma,sans-serif;font-size:small"><br></div><div class="gmail_default" style="font-family:tahoma,sans-serif;font-size:small"><br></div></div><div class="gmail_extra"><br clear="all"><div><div class="gmail_signature" data-smartmail="gmail_signature"><div dir="ltr"><div><span style="border-collapse:collapse"><font face="tahoma, sans-serif" size="1"><div style="color:rgb(32,32,32);text-align:justify"><br></div><div style="color:rgb(32,32,32);text-align:justify"><br></div><div style="color:rgb(32,32,32);text-align:justify"><b>&quot;</b></div></font><font face="trebuchet ms, sans-serif" size="1"><b><i>São os homens que mais me surpreendem na humanidade. Porque perdem a saúde para juntar dinheiro, depois perdem dinheiro para recuperar a saúde. E por pensarem ansiosamente no futuro, esquecem do presente de tal forma que acabam por não viver nem o presente nem o futuro. E vivem como se nunca fossem morrer e morrem como se nunca tivessem vivido” - Dalai Lama.</i></b></font><font face="tahoma, sans-serif" size="1"><div style="color:rgb(32,32,32);text-align:justify"><span><b>&quot;</b></span></div></font></span></div><font face="tahoma, sans-serif" size="1"><br></font><div><font face="tahoma, sans-serif" size="1"><b>Fred Chevitarese - GNU/Linux</b></font></div><div><a href="http://chevitarese.wordpress.com" target="_blank"><font face="tahoma, sans-serif" size="1"><b>http://chevitarese.wordpress.com</b></font></a></div><div><br></div><div><span style="font-family:&#39;Droid Sans&#39;,arial,sans-serif;font-size:13px;border-collapse:collapse;color:rgb(32,32,32)"><div style="text-align:justify"><br></div></span></div></div></div></div>
<br><div class="gmail_quote">Em 14 de dezembro de 2017 15:14, Elias Coutinho <span dir="ltr">&lt;<a href="mailto:coutinho.elias@gmail.com" target="_blank">coutinho.elias@gmail.com</a>&gt;</span> escreveu:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">Entendido Fred, meu problema é que possuo dois modelos, Item que é onde eu lanço a quantidade e o Papel que de fatoé onde fica a quantidade em estoque.<div><br></div><div>Se eu sobrescrever o save do modelo Item, como terei acesso ao modelo Papel e vice versa?</div><div>O problema é conceitual, não sei como proceder nesse caso.</div><div><br></div><div>Aquele exemplo que me mostrou serviu para resolver muita coisa, contudo esbarrei neste aqui.</div></div><div class="HOEnZb"><div class="h5"><div class="gmail_extra"><br><div class="gmail_quote">Em 14 de dezembro de 2017 14:08, Fred Chevitarese <span dir="ltr">&lt;<a href="mailto:fchevitarese@gmail.com" target="_blank">fchevitarese@gmail.com</a>&gt;</span> escreveu:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr"><div class="gmail_default" style="font-family:tahoma,sans-serif;font-size:small">Acho que é por causa do post_save. </div><div class="gmail_default" style="font-family:tahoma,sans-serif;font-size:small"><br></div><div class="gmail_default" style="font-family:tahoma,sans-serif;font-size:small">Acho que tudo isso aí deveria ser feito sobrescrevendo o método save do modelo. <br></div><div class="gmail_default" style="font-family:tahoma,sans-serif;font-size:small"><br></div><div class="gmail_default" style="font-family:tahoma,sans-serif;font-size:small"><br></div><div class="gmail_default" style="font-family:tahoma,sans-serif;font-size:small">Abraço!</div></div><div class="gmail_extra"><br clear="all"><div><div class="m_3266488757576201741m_-4250415599223902604gmail_signature" data-smartmail="gmail_signature"><div dir="ltr"><div><span style="border-collapse:collapse"><font face="tahoma, sans-serif" size="1"><div style="color:rgb(32,32,32);text-align:justify"><br></div><div style="color:rgb(32,32,32);text-align:justify"><br></div><div style="color:rgb(32,32,32);text-align:justify"><b>&quot;</b></div></font><font face="trebuchet ms, sans-serif" size="1"><b><i>São os homens que mais me surpreendem na humanidade. Porque perdem a saúde para juntar dinheiro, depois perdem dinheiro para recuperar a saúde. E por pensarem ansiosamente no futuro, esquecem do presente de tal forma que acabam por não viver nem o presente nem o futuro. E vivem como se nunca fossem morrer e morrem como se nunca tivessem vivido” - Dalai Lama.</i></b></font><font face="tahoma, sans-serif" size="1"><div style="color:rgb(32,32,32);text-align:justify"><span><b>&quot;</b></span></div></font></span></div><font face="tahoma, sans-serif" size="1"><br></font><div><font face="tahoma, sans-serif" size="1"><b>Fred Chevitarese - GNU/Linux</b></font></div><div><a href="http://chevitarese.wordpress.com" target="_blank"><font face="tahoma, sans-serif" size="1"><b>http://chevitarese.wordpress.c<wbr>om</b></font></a></div><div><br></div><div><span style="font-family:&#39;Droid Sans&#39;,arial,sans-serif;font-size:13px;border-collapse:collapse;color:rgb(32,32,32)"><div style="text-align:justify"><br></div></span></div></div></div></div><div><div class="m_3266488757576201741h5">
<br><div class="gmail_quote">Em 14 de dezembro de 2017 15:05, Elias Coutinho <span dir="ltr">&lt;<a href="mailto:coutinho.elias@gmail.com" target="_blank">coutinho.elias@gmail.com</a>&gt;</span> escreveu:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">Somente o virtualenv com python3 e instale o requirements.txt<div><br></div></div><div class="gmail_extra"><br><div class="gmail_quote"><div><div class="m_3266488757576201741m_-4250415599223902604h5">Em 14 de dezembro de 2017 12:59, willian firmino <span dir="ltr">&lt;<a href="mailto:willian.firmino1@gmail.com" target="_blank">willian.firmino1@gmail.com</a>&gt;</span> escreveu:<br></div></div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div><div class="m_3266488757576201741m_-4250415599223902604h5"><div dir="ltr">gostaria de ver este projeto rodando, o que tenho que configurar?<br></div><div class="gmail_extra"><br><div class="gmail_quote"><span>2017-12-13 18:59 GMT-02:00 Elias Coutinho <span dir="ltr">&lt;<a href="mailto:coutinho.elias@gmail.com" target="_blank">coutinho.elias@gmail.com</a>&gt;</span>:<br></span><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><span><div dir="ltr"><div>Boa tarde pessoal.</div><div>Estou tentando implementar um controle de estoque.</div><div>Por enquanto estou apenas nas movimentações de saída.</div><div>Quando eu emito um invoice ele corretamente dá a saída do estoque conforme código no models abaixo:</div><div>Inclusive ele verifica se o estoque vai ficar negativo e avisa!</div><div><br></div><div><a href="https://github.com/CoutinhoElias/danibraz/blob/master/danibraz/checkout/models.py#L137-L163" target="_blank">https://github.com/CoutinhoEli<wbr>as/danibraz/blob/master/danibr<wbr>az/checkout/models.py#L137-L16<wbr>3</a></div><div><br></div><div>O problema é quando editamos um documento, ele faz o processo acima novamente, ou seja, dá a saída novamente com novos valores. Isso ta errado! Deveria fazer uma análise da quantidade antes de salvar o estoque e dependendo do valor editado ele deveria adicionar ou remover do estoque. </div><div>Exemplo:</div><div><br></div><div>Na tabela Papel existe um campo chamado stock, conforme abaixo:</div><div><a href="https://github.com/CoutinhoElias/danibraz/blob/master/danibraz/checkout/models.py#L105-L116" target="_blank">https://github.com/CoutinhoEli<wbr>as/danibraz/blob/master/danibr<wbr>az/checkout/models.py#L105-L11<wbr>6</a> </div><div><br></div><div>Lá consta meu cadastro de produtos e minha quantidade em estoque de cada um deles.</div><div><br></div><div>Na tabela Item constamos itens de um documento de saída conforme postei no início.</div><div>Quando um item é salvo no banco de dados um signals é disparado e dou saída do estoque do produto que preenchi no campo title, isso ta lindo! Funcionando!</div><div><br></div><div>O problema é quando vou editar esse documento, ele no lugar de atualizar a diferença na quantidade de estoque da tabela Papel ele dá saída novamente!</div><div>Falei com um amigo e ele pediu para mostrar isso no fórum e ainda disse que o problema pode ser minha view do updade, então abaixo estão as duas views para os senhores tentarem identificar algum bug, pois já pesquisei em vários locais e não achei nada. </div><div><br></div><div><a href="https://github.com/CoutinhoElias/danibraz/blob/master/danibraz/checkout/views.py#L14-L54" target="_blank">https://github.com/CoutinhoEli<wbr>as/danibraz/blob/master/danibr<wbr>az/checkout/views.py#L14-L54</a></div><div><br></div><div>Obrigado.</div></div></span><span class="m_3266488757576201741m_-4250415599223902604m_4493402058870877773m_-6572688286763334657HOEnZb"><font color="#888888"><span class="m_3266488757576201741m_-4250415599223902604m_4493402058870877773HOEnZb"><font color="#888888">

<p></p>

-- <br>
Você recebeu essa mensagem porque está inscrito no grupo &quot;Django Brasil&quot; dos Grupos do Google.<br>
Para cancelar inscrição nesse grupo e parar de receber e-mails dele, envie um e-mail para <a href="mailto:django-brasil+unsubscribe@googlegroups.com" target="_blank">django-brasil+unsubscribe@goog<wbr>legroups.com</a>.</font></span><span><br>
Para mais opções, acesse <a href="https://groups.google.com/d/optout" target="_blank">https://groups.google.com/d/op<wbr>tout</a>.<br>
</span></font></span></blockquote></div><br></div></div></div><div class="m_3266488757576201741m_-4250415599223902604m_4493402058870877773HOEnZb"><div class="m_3266488757576201741m_-4250415599223902604m_4493402058870877773h5">

<p></p>

-- <br>
Você recebeu essa mensagem porque está inscrito em um tópico no grupo &quot;Django Brasil&quot; dos Grupos do Google.<br>
Para cancelar inscrição nesse tópico, acesse <a href="https://groups.google.com/d/topic/django-brasil/OvuWra_QpRE/unsubscribe" target="_blank">https://groups.google.com/d/to<wbr>pic/django-brasil/OvuWra_QpRE/<wbr>unsubscribe</a>.<br>
Para cancelar inscrição nesse grupo e todos os seus tópicos, envie um e-mail para <a href="mailto:django-brasil+unsubscribe@googlegroups.com" target="_blank">django-brasil+unsubscribe@goog<wbr>legroups.com</a>.<span><br>
Para mais opções, acesse <a href="https://groups.google.com/d/optout" target="_blank">https://groups.google.com/d/op<wbr>tout</a>.<br>
</span></div></div></blockquote></div><span class="m_3266488757576201741m_-4250415599223902604HOEnZb"><font color="#888888"><br><br clear="all"><div><br></div>-- <br><div class="m_3266488757576201741m_-4250415599223902604m_4493402058870877773gmail_signature" data-smartmail="gmail_signature">Elias Coutinho.<br>Aprender sobre alguns assuntos é fundamental.<br>Aprender sobre Deus é indiscutivelmente o melhor conteúdo.</div>
</font></span></div><div class="m_3266488757576201741m_-4250415599223902604HOEnZb"><div class="m_3266488757576201741m_-4250415599223902604h5">

<p></p>

-- <br>
Você recebeu essa mensagem porque está inscrito no grupo &quot;Django Brasil&quot; dos Grupos do Google.<br>
Para cancelar inscrição nesse grupo e parar de receber e-mails dele, envie um e-mail para <a href="mailto:django-brasil+unsubscribe@googlegroups.com" target="_blank">django-brasil+unsubscribe@goog<wbr>legroups.com</a>.<br>
Para mais opções, acesse <a href="https://groups.google.com/d/optout" target="_blank">https://groups.google.com/d/op<wbr>tout</a>.<br>
</div></div></blockquote></div><br></div></div></div><div class="m_3266488757576201741HOEnZb"><div class="m_3266488757576201741h5">

<p></p>

-- <br>
Você recebeu essa mensagem porque está inscrito em um tópico no grupo &quot;Django Brasil&quot; dos Grupos do Google.<br>
Para cancelar inscrição nesse tópico, acesse <a href="https://groups.google.com/d/topic/django-brasil/OvuWra_QpRE/unsubscribe" target="_blank">https://groups.google.com/d/to<wbr>pic/django-brasil/OvuWra_QpRE/<wbr>unsubscribe</a>.<br>
Para cancelar inscrição nesse grupo e todos os seus tópicos, envie um e-mail para <a href="mailto:django-brasil+unsubscribe@googlegroups.com" target="_blank">django-brasil+unsubscribe@goog<wbr>legroups.com</a>.<br>
Para mais opções, acesse <a href="https://groups.google.com/d/optout" target="_blank">https://groups.google.com/d/op<wbr>tout</a>.<br>
</div></div></blockquote></div><br><br clear="all"><div><br></div>-- <br><div class="m_3266488757576201741gmail_signature" data-smartmail="gmail_signature">Elias Coutinho.<br>Aprender sobre alguns assuntos é fundamental.<br>Aprender sobre Deus é indiscutivelmente o melhor conteúdo.</div>
</div>

<p></p>

-- <br>
Você recebeu essa mensagem porque está inscrito no grupo &quot;Django Brasil&quot; dos Grupos do Google.<br>
Para cancelar inscrição nesse grupo e parar de receber e-mails dele, envie um e-mail para <a href="mailto:django-brasil+unsubscribe@googlegroups.com" target="_blank">django-brasil+unsubscribe@<wbr>googlegroups.com</a>.<br>
Para mais opções, acesse <a href="https://groups.google.com/d/optout" target="_blank">https://groups.google.com/d/<wbr>optout</a>.<br>
</div></div></blockquote></div><br></div>

<p></p>

-- <br />
Você recebeu essa mensagem porque está inscrito em um tópico no grupo &quot;Django Brasil&quot; dos Grupos do Google.<br />
Para cancelar inscrição nesse tópico, acesse <a href="https://groups.google.com/d/topic/django-brasil/OvuWra_QpRE/unsubscribe">https://groups.google.com/d/topic/django-brasil/OvuWra_QpRE/unsubscribe</a>.<br />
Para cancelar inscrição nesse grupo e todos os seus tópicos, envie um e-mail para <a href="mailto:django-brasil+unsubscribe@googlegroups.com">django-brasil+unsubscribe@googlegroups.com</a>.<br />
Para mais opções, acesse <a href="https://groups.google.com/d/optout">https://groups.google.com/d/optout</a>.<br />
