<div dir="ltr">gostaria de ver este projeto rodando, o que tenho que configurar?<br></div><div class="gmail_extra"><br><div class="gmail_quote">2017-12-13 18:59 GMT-02:00 Elias Coutinho <span dir="ltr">&lt;<a href="mailto:coutinho.elias@gmail.com" target="_blank">coutinho.elias@gmail.com</a>&gt;</span>:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr"><div>Boa tarde pessoal.</div><div>Estou tentando implementar um controle de estoque.</div><div>Por enquanto estou apenas nas movimentações de saída.</div><div>Quando eu emito um invoice ele corretamente dá a saída do estoque conforme código no models abaixo:</div><div>Inclusive ele verifica se o estoque vai ficar negativo e avisa!</div><div><br></div><div><a href="https://github.com/CoutinhoElias/danibraz/blob/master/danibraz/checkout/models.py#L137-L163" target="_blank">https://github.com/<wbr>CoutinhoElias/danibraz/blob/<wbr>master/danibraz/checkout/<wbr>models.py#L137-L163</a></div><div><br></div><div>O problema é quando editamos um documento, ele faz o processo acima novamente, ou seja, dá a saída novamente com novos valores. Isso ta errado! Deveria fazer uma análise da quantidade antes de salvar o estoque e dependendo do valor editado ele deveria adicionar ou remover do estoque. </div><div>Exemplo:</div><div><br></div><div>Na tabela Papel existe um campo chamado stock, conforme abaixo:</div><div><a href="https://github.com/CoutinhoElias/danibraz/blob/master/danibraz/checkout/models.py#L105-L116" target="_blank">https://github.com/<wbr>CoutinhoElias/danibraz/blob/<wbr>master/danibraz/checkout/<wbr>models.py#L105-L116</a> </div><div><br></div><div>Lá consta meu cadastro de produtos e minha quantidade em estoque de cada um deles.</div><div><br></div><div>Na tabela Item constamos itens de um documento de saída conforme postei no início.</div><div>Quando um item é salvo no banco de dados um signals é disparado e dou saída do estoque do produto que preenchi no campo title, isso ta lindo! Funcionando!</div><div><br></div><div>O problema é quando vou editar esse documento, ele no lugar de atualizar a diferença na quantidade de estoque da tabela Papel ele dá saída novamente!</div><div>Falei com um amigo e ele pediu para mostrar isso no fórum e ainda disse que o problema pode ser minha view do updade, então abaixo estão as duas views para os senhores tentarem identificar algum bug, pois já pesquisei em vários locais e não achei nada. </div><div><br></div><div><a href="https://github.com/CoutinhoElias/danibraz/blob/master/danibraz/checkout/views.py#L14-L54" target="_blank">https://github.com/<wbr>CoutinhoElias/danibraz/blob/<wbr>master/danibraz/checkout/<wbr>views.py#L14-L54</a></div><div><br></div><div>Obrigado.</div></div><span class="HOEnZb"><font color="#888888">

<p></p>

-- <br>
Você recebeu essa mensagem porque está inscrito no grupo &quot;Django Brasil&quot; dos Grupos do Google.<br>
Para cancelar inscrição nesse grupo e parar de receber e-mails dele, envie um e-mail para <a href="mailto:django-brasil+unsubscribe@googlegroups.com" target="_blank">django-brasil+unsubscribe@<wbr>googlegroups.com</a>.<br>
Para mais opções, acesse <a href="https://groups.google.com/d/optout" target="_blank">https://groups.google.com/d/<wbr>optout</a>.<br>
</font></span></blockquote></div><br></div>

<p></p>

-- <br />
Você recebeu essa mensagem porque está inscrito em um tópico no grupo &quot;Django Brasil&quot; dos Grupos do Google.<br />
Para cancelar inscrição nesse tópico, acesse <a href="https://groups.google.com/d/topic/django-brasil/OvuWra_QpRE/unsubscribe">https://groups.google.com/d/topic/django-brasil/OvuWra_QpRE/unsubscribe</a>.<br />
Para cancelar inscrição nesse grupo e todos os seus tópicos, envie um e-mail para <a href="mailto:django-brasil+unsubscribe@googlegroups.com">django-brasil+unsubscribe@googlegroups.com</a>.<br />
Para mais opções, acesse <a href="https://groups.google.com/d/optout">https://groups.google.com/d/optout</a>.<br />
