<div dir="ltr">E ai Elias!<div><br></div><div>Bah, agora que vi q vc definou o FormSet la nos forms. Foi mal, nao tinha visto.</div><div>O ta acontendo deve ser isso ai mesmo entao, tu ta tentando salvar os SearchItems na view e ele tenta fazer isso de novo no signal..</div><div>O que tu pode fazer eh desconectar esse signal antes de salvar:</div><div><br></div><div>https://docs.djangoproject.com/en/2.2/topics/signals/#disconnecting-signals</div><div><br></div><div>Mas faz isso usando um try catch, e no finnaly vc coloca o Signal de volta a ativa....</div><div><br></div><div><br></div><div>Espero ter ajudado, e desculpa a mensagem anterior.</div><div><br>On Wednesday, 30 January 2019 18:19:50 UTC-2, Francisco Petry Rauber  wrote:<blockquote class="gmail_quote" style="margin: 0;margin-left: 0.8ex;border-left: 1px #ccc solid;padding-left: 1ex;"><div dir="ltr">Ola ____<div><br></div><div>Cara, nao deu pra entender muito bem.</div><div>Nao existe esse SearchItemFormSet que vc mostra na view.</div><div><br></div><div>Acho q esse deve ser o problema, vc pode ter se confundido em algum ponto...</div><div><br>No mais o teu singnal ta certo, ele verifica se o que ta sendo salvo eh uma criacao ou nao. Sendo assim esse erro de duplicidade nao deve ser por conta de Searchs ja existentes que estao sendo salvos.</div><div><br></div><div>Espero ter ajudado<br><br><br>On Saturday, 26 January 2019 10:55:27 UTC-2, Elias Coutinho  wrote:<blockquote class="gmail_quote" style="margin:0;margin-left:0.8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">Bom dia meus amigos.<div><br></div><div>Tenho dois forms que utilizo para inserir dados nos mesmos modelos em situações diferentes:</div><div><br></div><div><pre style="background-color:#2b2b2b;color:#a9b7c6;font-family:&#39;DejaVu Sans Mono&#39;;font-size:9,0pt"><span style="color:#cc7832">class </span>SearchFormCompleto(forms.<wbr>ModelForm):<br><br>    <span style="color:#cc7832">class </span>Meta:<br>        model = Search<br>        fields = (<br>            <span style="color:#6a8759">&#39;search_key&#39;</span><span style="color:#cc7832">,<br></span><span style="color:#cc7832">            </span><span style="color:#6a8759">&#39;person&#39;</span><span style="color:#cc7832">,<br></span><span style="color:#cc7832">            </span><span style="color:#6a8759">&#39;researched&#39;</span><span style="color:#cc7832">,<br></span><span style="color:#cc7832">        </span>)<br><br><br><span style="color:#cc7832">class </span>SearchForm(forms.ModelForm):<br><br>    <span style="color:#cc7832">class </span>Meta:<br>        model = Search<br>        fields = <span style="color:#6a8759">&#39;__all__&#39;<br></span><span style="color:#6a8759">        </span>exclude = ()<br><br>    layout = Layout(<br>        Fieldset(<span style="color:#6a8759">&quot;Responda com Calma.&quot;</span><span style="color:#cc7832">, </span>Row(<span style="color:#6a8759">&#39;person&#39;</span><span style="color:#cc7832">, </span><span style="color:#6a8759">&#39;search_key&#39;</span>)<span style="color:#cc7832">, </span>Row(<span style="color:#6a8759">&#39;researched&#39;</span><span style="color:#cc7832">,</span>)<span style="color:#cc7832">,</span>))<br><br><br>SearchItemFormSet = inlineformset_factory(Search<span style="color:#cc7832">, </span>SearchItem<span style="color:#cc7832">,<br></span><span style="color:#cc7832">                                          </span><span style="color:#aa4926">exclude</span>=(<span style="color:#6a8759">&#39;id&#39;</span><span style="color:#cc7832">,</span>)<span style="color:#cc7832">,<br></span><span style="color:#cc7832">                                          </span><span style="color:#aa4926">can_delete</span>=<span style="color:#cc7832">True,<br></span><span style="color:#cc7832">                                          </span><span style="color:#aa4926">fields</span>=(<span style="color:#6a8759">&#39;question&#39;</span><span style="color:#cc7832">, </span><span style="color:#6a8759">&#39;response&#39;</span>)<span style="color:#cc7832">, </span><span style="color:#aa4926">extra</span>=<span style="color:#6897bb">1</span>)</pre><br><br></div><div>Estes forms referem-se aos modelos abaixo:</div><div><br></div><div><pre style="background-color:#2b2b2b;color:#a9b7c6;font-family:&#39;DejaVu Sans Mono&#39;;font-size:9,0pt"><span style="color:#cc7832">class </span>Search(models.Model):<br>    search_key = models.CharField(<br>        <span style="color:#6a8759">&#39;Período&#39;</span><span style="color:#cc7832">, </span><span style="color:#aa4926">max_length</span>=<span style="color:#6897bb">200</span><span style="color:#cc7832">, </span><span style="color:#aa4926">db_index</span>=<span style="color:#cc7832">False</span>)<br>    person = models.ForeignKey(<br>        <span style="color:#6a8759">&#39;core.client&#39;</span><span style="color:#cc7832">, </span><span style="color:#aa4926">related_name</span>=<span style="color:#6a8759">&#39;Cliente&#39;</span><span style="color:#cc7832">, </span><span style="color:#aa4926">on_delete</span>=models.CASCADE)<br>    researched = models.CharField(<span style="color:#6a8759">&#39;<wbr>Entrevistado&#39;</span><span style="color:#cc7832">, </span><span style="color:#aa4926">max_length</span>=<span style="color:#6897bb">200</span>)<br>    participation_on = models.DateField(<br>        <span style="color:#6a8759">&#39;Período da pesquisa&#39;</span><span style="color:#cc7832">,<br></span><span style="color:#cc7832">        </span><span style="color:#aa4926">auto_now_add</span>=<span style="color:#cc7832">True,<br></span><span style="color:#cc7832">        </span><span style="color:#aa4926">auto_now</span>=<span style="color:#cc7832">False<br></span><span style="color:#cc7832">    </span>)<br>    created_on = models.DateTimeField(<br>        <span style="color:#6a8759">&#39;Solicitado em&#39;</span><span style="color:#cc7832">,<br></span><span style="color:#cc7832">        </span><span style="color:#aa4926">auto_now_add</span>=<span style="color:#cc7832">True,<br></span><span style="color:#cc7832">        </span><span style="color:#aa4926">auto_now</span>=<span style="color:#cc7832">False<br></span><span style="color:#cc7832">    </span>)<br><br>    <span style="color:#cc7832">class </span>Meta:<br>        verbose_name = <span style="color:#6a8759">&#39;Pesquisa&#39;<br></span><span style="color:#6a8759">        </span>verbose_name_plural = <span style="color:#6a8759">&#39;Pesquisas&#39;<br></span><span style="color:#6a8759">        </span>unique_together = ((<span style="color:#6a8759">&#39;search_key&#39;</span><span style="color:#cc7832">, </span><span style="color:#6a8759">&#39;person&#39;</span>)<span style="color:#cc7832">,</span>)<br>        ordering = (<span style="color:#6a8759">&#39;-participation_on&#39;</span><span style="color:#cc7832">,</span>)<br><br>    <span style="color:#cc7832">def </span><span style="color:#ffc66d">get_absolute_url</span>(<span style="color:#94558d">self</span>):<br>        <span style="color:#cc7832">return </span>reverse(<span style="color:#6a8759">&#39;person_client_detail&#39;</span><span style="color:#cc7832"><wbr>, </span><span style="color:#aa4926">args</span>=[<span style="color:#8888c6">str</span>(<span style="color:#94558d">self</span>.pk)])<br><br>    <span style="color:#cc7832">def </span><span style="color:#b200b2">__str__</span>(<span style="color:#94558d">self</span>):<br>        <span style="color:#cc7832">return </span><span style="color:#94558d">self</span>.search_key</pre><br>Que possui um signals descrito abaixo:</div><div><br></div><div><pre style="background-color:#2b2b2b;color:#a9b7c6;font-family:&#39;DejaVu Sans Mono&#39;;font-size:9,0pt"><span style="color:#cc7832">def </span><span style="color:#ffc66d">post_save_search</span>(<span style="color:#808080">sender</span><span style="color:#cc7832">, </span>instance<span style="color:#cc7832">, </span>created<span style="color:#cc7832">,  </span><span style="color:#808080">**kwargs</span>):<br>    <span style="color:#cc7832">if </span>created:<br>        questions = Question.objects.all()<br>        <span style="color:#808080"># search = Search.objects.filter(pk=<a href="http://instance.pk" rel="nofollow" target="_blank" onmousedown="this.href=&#39;http://www.google.com/url?q\x3dhttp%3A%2F%2Finstance.pk\x26sa\x3dD\x26sntz\x3d1\x26usg\x3dAFQjCNGCgTrmg7tABv3bKS5AmsafBDgalw&#39;;return true;" onclick="this.href=&#39;http://www.google.com/url?q\x3dhttp%3A%2F%2Finstance.pk\x26sa\x3dD\x26sntz\x3d1\x26usg\x3dAFQjCNGCgTrmg7tABv3bKS5AmsafBDgalw&#39;;return true;">insta<wbr>nce.pk</a>)<br></span><span style="color:#808080"><br></span><span style="color:#808080">        </span>lista = []<br><br>        <span style="color:#808080"># print(worksheet.nrows)<br></span><span style="color:#808080">        </span><span style="color:#cc7832">for </span>question <span style="color:#cc7832">in </span>questions:<br>            <span style="color:#8888c6">print</span>(<span style="color:#6a8759">&#39;search_id=&#39;</span><span style="color:#cc7832">, </span><a href="http://instance.pk" rel="nofollow" target="_blank" onmousedown="this.href=&#39;http://www.google.com/url?q\x3dhttp%3A%2F%2Finstance.pk\x26sa\x3dD\x26sntz\x3d1\x26usg\x3dAFQjCNGCgTrmg7tABv3bKS5AmsafBDgalw&#39;;return true;" onclick="this.href=&#39;http://www.google.com/url?q\x3dhttp%3A%2F%2Finstance.pk\x26sa\x3dD\x26sntz\x3d1\x26usg\x3dAFQjCNGCgTrmg7tABv3bKS5AmsafBDgalw&#39;;return true;">instance.pk</a><span style="color:#cc7832">, </span><span style="color:#6a8759">&#39;question_id=&#39;</span><span style="color:#cc7832">, </span><a href="http://question.pk" rel="nofollow" target="_blank" onmousedown="this.href=&#39;http://www.google.com/url?q\x3dhttp%3A%2F%2Fquestion.pk\x26sa\x3dD\x26sntz\x3d1\x26usg\x3dAFQjCNHHZE7hUez3HyzrTgH1UXIGi0n9ow&#39;;return true;" onclick="this.href=&#39;http://www.google.com/url?q\x3dhttp%3A%2F%2Fquestion.pk\x26sa\x3dD\x26sntz\x3d1\x26usg\x3dAFQjCNHHZE7hUez3HyzrTgH1UXIGi0n9ow&#39;;return true;">question.pk</a>)<br>            lista.append(<br>                SearchItem(<span style="color:#aa4926">search_id</span>=<a href="http://instance.pk" rel="nofollow" target="_blank" onmousedown="this.href=&#39;http://www.google.com/url?q\x3dhttp%3A%2F%2Finstance.pk\x26sa\x3dD\x26sntz\x3d1\x26usg\x3dAFQjCNGCgTrmg7tABv3bKS5AmsafBDgalw&#39;;return true;" onclick="this.href=&#39;http://www.google.com/url?q\x3dhttp%3A%2F%2Finstance.pk\x26sa\x3dD\x26sntz\x3d1\x26usg\x3dAFQjCNGCgTrmg7tABv3bKS5AmsafBDgalw&#39;;return true;">instance.<wbr>pk</a><span style="color:#cc7832">,<br></span><span style="color:#cc7832">                           </span><span style="color:#aa4926">question_id</span>=<a href="http://question.pk" rel="nofollow" target="_blank" onmousedown="this.href=&#39;http://www.google.com/url?q\x3dhttp%3A%2F%2Fquestion.pk\x26sa\x3dD\x26sntz\x3d1\x26usg\x3dAFQjCNHHZE7hUez3HyzrTgH1UXIGi0n9ow&#39;;return true;" onclick="this.href=&#39;http://www.google.com/url?q\x3dhttp%3A%2F%2Fquestion.pk\x26sa\x3dD\x26sntz\x3d1\x26usg\x3dAFQjCNHHZE7hUez3HyzrTgH1UXIGi0n9ow&#39;;return true;">question.pk</a><span style="color:#cc7832">,<br></span><span style="color:#cc7832">                           </span><span style="color:#aa4926">response</span>=<span style="color:#cc7832">False,<br></span><span style="color:#cc7832">                           </span>)<br>            )<br><br>        SearchItem.objects.bulk_<wbr>create(lista)<br><br><br>models.signals.post_save.<wbr>connect(<br>    post_save_search<span style="color:#cc7832">, </span><span style="color:#aa4926">sender</span>=Search<span style="color:#cc7832">, </span><span style="color:#aa4926">dispatch_uid</span>=<span style="color:#6a8759">&#39;post_save_<wbr>search&#39;<br></span>)</pre><div><br></div>e o modelo SeachItem que possui um FK de Seach acima:</div><div><br></div><div><div style="background-color:rgb(250,250,250);border-color:rgb(187,187,187);border-style:solid;border-width:1px"><code><div><pre style="background-color:#2b2b2b;color:#a9b7c6;font-family:&#39;DejaVu Sans Mono&#39;;font-size:9,0pt"><span style="color:#cc7832"><span style="color:#008">class</span><span style="color:#000"> </span></span><span style="color:#606">SearchItem</span><span style="color:#660">(</span><span style="color:#000">models</span><span style="color:#660">.</span><span style="color:#606">Model</span><span style="color:#660">):</span><span style="color:#000"><br>    RESPONSE_CHOICES </span><span style="color:#660">=</span><span style="color:#000"> </span><span style="color:#660">(</span><span style="color:#000"><br>        </span><span style="color:#660">(</span><span style="color:#6a8759"><span style="color:#080">&#39;V&#39;</span></span><span style="color:#cc7832"><span style="color:#660">,</span><span style="color:#000"> </span></span><span style="color:#6a8759"><span style="color:#080">&#39;Verdadeiro&#39;</span></span><span style="color:#660">)</span><span style="color:#cc7832"><span style="color:#660">,</span><span style="color:#000"><br></span></span><span style="color:#cc7832"><span style="color:#000">        </span></span><span style="color:#660">(</span><span style="color:#6a8759"><span style="color:#080">&#39;F&#39;</span></span><span style="color:#cc7832"><span style="color:#660">,</span><span style="color:#000"> </span></span><span style="color:#6a8759"><span style="color:#080">&#39;Falso&#39;</span></span><span style="color:#660">)</span><span style="color:#cc7832"><span style="color:#660">,</span><span style="color:#000"><br></span></span><span style="color:#cc7832"><span style="color:#000">        </span></span><span style="color:#660">(</span><span style="color:#6a8759"><span style="color:#080">&#39;I&#39;</span></span><span style="color:#cc7832"><span style="color:#660">,</span><span style="color:#000"> </span></span><span style="color:#6a8759"><span style="color:#080">&#39;Indefinido&#39;</span></span><span style="color:#660">)</span><span style="color:#cc7832"><span style="color:#660">,</span><span style="color:#000"><br></span></span><span style="color:#cc7832"><span style="color:#000">    </span></span><span style="color:#660">)</span><span style="color:#000"><br><br>    search </span><span style="color:#660">=</span><span style="color:#000"> models</span><span style="color:#660">.</span><span style="color:#606">ForeignKey</span><span style="color:#660">(</span><span style="color:#000"><br>        </span><span style="color:#6a8759"><span style="color:#080">&#39;core.search&#39;</span></span><span style="color:#cc7832"><span style="color:#660">,</span><span style="color:#000"> </span></span><span style="color:#aa4926"><span style="color:#000">related_name</span></span><span style="color:#660">=</span><span style="color:#6a8759"><span style="color:#080">&#39;Periodo&#39;</span></span><span style="color:#cc7832"><span style="color:#660">,</span><span style="color:#000"> </span></span><span style="color:#aa4926"><span style="color:#000">on_delete</span></span><span style="color:#660">=</span><span style="color:#000">models</span><span style="color:#660">.</span><span style="color:#000">CASCADE</span><span style="color:#cc7832"><span style="color:#660">,</span><span style="color:#000"> </span></span><span style="color:#aa4926"><span style="color:#000">verbose_name</span></span><span style="color:#660">=</span><span style="color:#6a8759"><span style="color:#080">&quot;Período da Pesquisa&quot;</span></span><span style="color:#660">)</span><span style="color:#000"><br>    question </span><span style="color:#660">=</span><span style="color:#000"> models</span><span style="color:#660">.</span><span style="color:#606">ForeignKey</span><span style="color:#660">(</span><span style="color:#000"><br>        </span><span style="color:#6a8759"><span style="color:#080">&#39;core.question&#39;</span></span><span style="color:#cc7832"><span style="color:#660">,</span><span style="color:#000"> </span></span><span style="color:#aa4926"><span style="color:#000">related_name</span></span><span style="color:#660">=</span><span style="color:#6a8759"><span style="color:#080">&#39;Pergunta&#39;</span></span><span style="color:#cc7832"><span style="color:#660">,</span><span style="color:#000"> </span></span><span style="color:#aa4926"><span style="color:#000">on_delete</span></span><span style="color:#660">=</span><span style="color:#000">models</span><span style="color:#660">.</span><span style="color:#000">CASCADE</span><span style="color:#cc7832"><span style="color:#660">,</span><span style="color:#000"> </span></span><span style="color:#aa4926"><span style="color:#000">verbose_name</span></span><span style="color:#660">=</span><span style="color:#6a8759"><span style="color:#080">&quot;Pergunta&quot;</span></span><span style="color:#660">)</span><span style="color:#000"><br>    response </span><span style="color:#660">=</span><span style="color:#000"> models</span><span style="color:#660">.</span><span style="color:#606">BooleanField</span><span style="color:#660">(</span><span style="color:#6a8759"><span style="color:#080">&#39;Resposta&#39;</span></span><span style="color:#660"><wbr>)</span><span style="color:#000"><br><br>    </span><span style="color:#cc7832"><span style="color:#008">class</span><span style="color:#000"> </span></span><span style="color:#606">Meta</span><span style="color:#660">:</span><span style="color:#000"><br>        verbose_name </span><span style="color:#660">=</span><span style="color:#000"> </span><span style="color:#6a8759"><span style="color:#080">&#39;Pesquisa Detalhe&#39;</span><span style="color:#000"><br></span></span><span style="color:#6a8759"><span style="color:#000">        </span></span><span style="color:#000">verbose_name_plural </span><span style="color:#660">=</span><span style="color:#000"> </span><span style="color:#6a8759"><span style="color:#080">&#39;Pesquisas Detalhe&#39;</span><span style="color:#000"><br></span></span><span style="color:#6a8759"><span style="color:#000">        </span></span><span style="color:#000">unique_together </span><span style="color:#660">=</span><span style="color:#000"> </span><span style="color:#660">((</span><span style="color:#6a8759"><span style="color:#080">&#39;search&#39;</span></span><span style="color:#cc7832"><span style="color:#660">,</span><span style="color:#000"> </span></span><span style="color:#6a8759"><span style="color:#080">&#39;question&#39;</span></span><span style="color:#660">)</span><span style="color:#cc7832"><span style="color:#660">,</span></span><span style="color:#660">)</span><span style="color:#000"><br>        ordering </span><span style="color:#660">=</span><span style="color:#000"> </span><span style="color:#660">(</span><span style="color:#6a8759"><span style="color:#080">&#39;-question&#39;</span></span><span style="color:#cc7832"><span style="color:#660">,</span></span><span style="color:#660">)</span><span style="color:#000"><br><br>    </span><span style="color:#cc7832"><span style="color:#008">def</span><span style="color:#000"> </span></span><span style="color:#b200b2"><span style="color:#000">__str__</span></span><span style="color:#660">(</span><span style="color:#94558d"><span style="color:#008">self</span></span><span style="color:#660">):</span><span style="color:#000"><br>        </span><span style="color:#cc7832"><span style="color:#008">return</span><span style="color:#000"> </span></span><span style="color:#94558d"><span style="color:#008">self</span></span><span style="color:#660">.</span><span style="color:#000">question</span><span style="color:#660">.</span><span style="color:#000">question</span></pre></div></code></div><br> SeachItem também possui uma FK de Question:</div><div><br></div><div><pre style="background-color:#2b2b2b;color:#a9b7c6;font-family:&#39;DejaVu Sans Mono&#39;;font-size:9,0pt"><span style="color:#cc7832">class </span>Question(models.Model):<br>    LEVEL_CHOICES = (<br>        (<span style="color:#6a8759">&#39;0&#39;</span><span style="color:#cc7832">, </span><span style="color:#6a8759">&#39;Dependencia&#39;</span>)<span style="color:#cc7832">,<br></span><span style="color:#cc7832">        </span>(<span style="color:#6a8759">&#39;1&#39;</span><span style="color:#cc7832">, </span><span style="color:#6a8759">&#39;Confianca&#39;</span>)<span style="color:#cc7832">,<br></span><span style="color:#cc7832">        </span>(<span style="color:#6a8759">&#39;2&#39;</span><span style="color:#cc7832">, </span><span style="color:#6a8759">&#39;Comprometimento&#39;</span>)<span style="color:#cc7832">,<br></span><span style="color:#cc7832">        </span>(<span style="color:#6a8759">&#39;3&#39;</span><span style="color:#cc7832">, </span><span style="color:#6a8759">&#39;Preditiva&#39;</span>)<span style="color:#cc7832">,<br></span><span style="color:#cc7832">    </span>)<br>    question = models.CharField(<span style="color:#6a8759">&#39;Pergunta&#39;</span><span style="color:#cc7832">, </span><span style="color:#aa4926">max_length</span>=<span style="color:#6897bb">200</span>)<br>    level = models.CharField(<span style="color:#6a8759">&#39;Nível&#39;</span><span style="color:#cc7832">, </span><span style="color:#aa4926">max_length</span>=<span style="color:#6897bb">15</span><span style="color:#cc7832">,<br></span><span style="color:#cc7832">                             </span><span style="color:#aa4926">choices</span>=LEVEL_CHOICES<span style="color:#cc7832">, </span><span style="color:#aa4926">default</span>=<span style="color:#6a8759">&#39;0&#39;</span>)<br><br>    <span style="color:#cc7832">class </span>Meta:<br>        verbose_name = <span style="color:#6a8759">&#39;Questão&#39;<br></span><span style="color:#6a8759">        </span>verbose_name_plural = <span style="color:#6a8759">&#39;Questões&#39;<br></span><span style="color:#6a8759">        </span>ordering = (<span style="color:#6a8759">&#39;-level&#39;</span><span style="color:#cc7832">,</span>)<br><br>    <span style="color:#cc7832">def </span><span style="color:#b200b2">__str__</span>(<span style="color:#94558d">self</span>):<br>        <span style="color:#cc7832">return </span><span style="color:#94558d">self</span>.question</pre><br> Meu problema começa aqui:</div><div><br></div><div>Quando uso a view seach_create ele registra os dados no modelo Seach e por sua vez o signals lança as perguntas no modelo SeachItem (Isso está lindo! Pelo menos para mim pois a situação exige que seja assim), veja como está a view:</div><div><br></div><div><pre style="background-color:#2b2b2b;color:#a9b7c6;font-family:&#39;DejaVu Sans Mono&#39;;font-size:9,0pt"><span style="color:#cc7832">def </span><span style="color:#ffc66d">seach_create</span>(request):<br>    <span style="color:#cc7832">if </span>request.method == <span style="color:#6a8759">&#39;POST&#39;</span>:<br>        form = SearchForm(request.POST)<br><br>        <span style="color:#cc7832">if </span>form.is_valid():<br>            <span style="color:#8888c6">print</span>(<span style="color:#6a8759">&#39;&lt;&lt;&lt;&lt;==== FORM VALIDO ====&gt;&gt;&gt;&gt;&#39;</span>)<br>            new = form.save(<span style="color:#aa4926">commit</span>=<span style="color:#cc7832">False</span>)<br>            new.save()<br>            <span style="color:#808080">#form.save_m2m()<br></span><span style="color:#808080"><br></span><span style="color:#808080">            </span><span style="color:#cc7832">return </span>HttpResponseRedirect(<span style="color:#6a8759">&#39;/<wbr>pesquisa/listar&#39;</span>)<br>        <span style="color:#cc7832">else</span>:<br>            <span style="color:#8888c6">print</span>(<span style="color:#6a8759">&#39;&lt;&lt;&lt;&lt;==== AVISO DE FORMULARIO INVALIDO ====&gt;&gt;&gt;&gt;&#39;</span>)<br>            <span style="color:#8888c6">print</span>(form)<br>            <span style="color:#cc7832">return </span>render(request<span style="color:#cc7832">, </span><span style="color:#6a8759">&#39;seach_create.html&#39;</span><span style="color:#cc7832">, </span>{<span style="color:#6a8759">&#39;form&#39;</span>:form})<br>    <span style="color:#cc7832">else</span>:<br>        context = {<span style="color:#6a8759">&#39;form&#39;</span>: SearchForm()}<br>        <span style="color:#cc7832">return </span>render(request<span style="color:#cc7832">, </span><span style="color:#6a8759">&#39;seach_create.html&#39;</span><span style="color:#cc7832">, </span>context)</pre><pre style="background-color:#2b2b2b;color:#a9b7c6;font-family:&#39;DejaVu Sans Mono&#39;;font-size:9,0pt"><br></pre><pre style="background-color:#2b2b2b;color:#a9b7c6;font-family:&#39;DejaVu Sans Mono&#39;;font-size:9,0pt"><br></pre></div><div><br></div><div>Quando uso a view pesquisa_create ele faz a mesma coisa e em seguida tenta registrar os fields do formset, e é aí que ele retorna o erro de duplicidade de chave Veja como está a view:</div><div><br></div><div><pre style="background-color:#2b2b2b;color:#a9b7c6;font-family:&#39;DejaVu Sans Mono&#39;;font-size:9,0pt"><span style="color:#cc7832">def </span><span style="color:#ffc66d">pesquisa_create</span>(request):<br>    <span style="color:#808080">success_message </span>= <span style="color:#6a8759">&#39;The Search was edited correctly.&#39;<br></span><span style="color:#6a8759">    </span><span style="color:#cc7832">if </span>request.method == <span style="color:#6a8759">&#39;POST&#39;</span>:<br>        form = SearchForm(request.POST)<br>        formset = SearchItemFormSet(request.<wbr>POST)<br><br>        <span style="color:#cc7832">if </span>form.is_valid() <span style="color:#cc7832">and </span>formset.is_valid():<br>            <span style="color:#cc7832">with </span>transaction.atomic():<br><br>                receipt = form.save()<br>                formset.instance = receipt<br>                formset.save()<br><br>                <span style="color:#cc7832">return </span>redirect(<span style="color:#6a8759">&#39;/cliente/listar/&#39;</span>)<br>    <span style="color:#cc7832">else</span>:<br>        form = SearchForm()<br>        <span style="color:#808080"># initial={&#39;author&#39;: request.user}<br></span><span style="color:#808080">        </span>formset = SearchItemFormSet()<br><br>    forms = [formset.empty_form] + formset.forms<br>    context = {<span style="color:#6a8759">&#39;form&#39;</span>: form<span style="color:#cc7832">, </span><span style="color:#6a8759">&#39;formset&#39;</span>: formset<span style="color:#cc7832">, </span><span style="color:#6a8759">&#39;forms&#39;</span>: forms}<br>    <span style="color:#cc7832">return </span>render(request<span style="color:#cc7832">, </span><span style="color:#6a8759">&#39;receipt_form.html&#39;</span><span style="color:#cc7832">, </span>context)</pre><br><b>A minha pergunta é bem direta:<br><br>O que devo fazer em pesquisa_create para ele não acionar o signals ou para usar get_or_create no formset?</b></div><div><b><br></b></div><div><b>Obrigado.<br></b><br></div></div></blockquote></div></div></blockquote></div></div>

<p></p>

-- <br />
Você recebeu essa mensagem porque está inscrito em um tópico no grupo &quot;Django Brasil&quot; dos Grupos do Google.<br />
Para cancelar inscrição nesse tópico, acesse <a href="https://groups.google.com/d/topic/django-brasil/cwmdhRYJa_A/unsubscribe">https://groups.google.com/d/topic/django-brasil/cwmdhRYJa_A/unsubscribe</a>.<br />
Para cancelar inscrição nesse grupo e todos os seus tópicos, envie um e-mail para <a href="mailto:django-brasil+unsubscribe@googlegroups.com">django-brasil+unsubscribe@googlegroups.com</a>.<br />
Para mais opções, acesse <a href="https://groups.google.com/d/optout">https://groups.google.com/d/optout</a>.<br />
