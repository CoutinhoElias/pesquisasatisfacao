<div dir="ltr">Eu fiz isso aqui:<div><br></div><div><div><font face="monospace, monospace">def count_paid(paid=True):</font></div><div><font face="monospace, monospace">    return Subscription.objects.filter(paid=paid).count()</font></div><div><font face="monospace, monospace"><br></font></div><div><font face="monospace, monospace"><br></font></div><div><font face="monospace, monospace">def paid_list_json(request):</font></div><div><font face="monospace, monospace">    &#39;&#39;&#39; JSON used to generate the graphic &#39;&#39;&#39;</font></div><div><font face="monospace, monospace">    &#39;&#39;&#39; Percent of paid &#39;&#39;&#39;</font></div><div><font face="monospace, monospace">    paid = count_paid()</font></div><div><font face="monospace, monospace">    total = Subscription.objects.count()</font></div><div><font face="monospace, monospace">    paid_yes = int(paid * 100 / total)</font></div><div><font face="monospace, monospace">    paid_no = 100 - paid_yes</font></div><div><font face="monospace, monospace">    data = [{&#39;label&#39;: &#39;Sim&#39;, &#39;value&#39;: paid_yes},</font></div><div><font face="monospace, monospace">            {&#39;label&#39;: &#39;Não&#39;, &#39;value&#39;: paid_no},</font></div><div><font face="monospace, monospace">            ]</font></div><div><font face="monospace, monospace"><br></font></div><div><font face="monospace, monospace">    resp = JsonResponse(data, safe=False)</font></div><div><font face="monospace, monospace">    return HttpResponse(resp.content)</font></div><div><font face="monospace, monospace"><br></font></div><div><font face="monospace, monospace"><br></font></div><div><font face="monospace, monospace">def paid_column_json(request):</font></div><div><font face="monospace, monospace">    &#39;&#39;&#39; JSON used to generate the graphic &#39;&#39;&#39;</font></div><div><font face="monospace, monospace">    &#39;&#39;&#39; Quantity of paid &#39;&#39;&#39;</font></div><div><font face="monospace, monospace">    paid_yes = count_paid()</font></div><div><font face="monospace, monospace">    paid_no = count_paid(paid=False)</font></div><div><font face="monospace, monospace">    data = [{&#39;label&#39;: &#39;Sim&#39;, &#39;value&#39;: paid_yes},</font></div><div><font face="monospace, monospace">            {&#39;label&#39;: &#39;Não&#39;, &#39;value&#39;: paid_no},</font></div><div><font face="monospace, monospace">            ]</font></div><div><font face="monospace, monospace"><br></font></div><div><font face="monospace, monospace">    resp = JsonResponse(data, safe=False)</font></div><div><font face="monospace, monospace">    return HttpResponse(resp.content)</font></div></div><div><font face="monospace, monospace"><br></font></div><div><br></div><div><b>Mas como eu crio um teste para tudo isso?</b></div></div><div class="gmail_extra"><br clear="all"><div><div class="gmail_signature"><div dir="ltr"><table border="0" cellpadding="0" width="180" style="font-family:&#39;Times New Roman&#39;;table-layout:fixed"><tbody><tr><td align="left" valign="middle" width="80"><p style="margin-right:10px;font-family:Helvetica,Arial,sans-serif;font-size:10px;line-height:12px;margin-bottom:10px"><a href="http://eventex-regis.herokuapp.com/" style="text-decoration:none" target="_blank">EVENTEX </a><a href="https://github.com/rg3915/wttd2" style="display:inline;text-decoration:none" target="_blank"><img width="16" height="16" src="https://s3.amazonaws.com/htmlsig-assets/round/github.png" alt="github" style="margin-bottom:2px;border:none;display:inline"></a><span style="white-space:nowrap"><img src="https://s3.amazonaws.com/htmlsig-assets/spacer.gif" width="2"></span></p></td><td align="left" nowrap width="100"><p style="font-family:Helvetica,Arial,sans-serif;font-size:10px;line-height:12px;color:rgb(33,33,33);margin-bottom:10px"><span style="font-weight:bold;display:inline">Regis da Silva</span><br><span style="display:inline"></span><span style="display:inline">Web Developer</span><br><a href="http://grandeportal.github.io/" style="text-decoration:none" target="_blank">grandeportal.github.io</a> <span style="display:inline"><br></span></p><p style="font-size:0px;line-height:0;font-family:Helvetica,Arial,sans-serif"><a href="https://about.me/rg3915" style="display:inline;text-decoration:none" target="_blank"><img width="16" height="16" src="http://www.kevinpiersoul.com/assets/images/about-active.png" alt="Aboutme" style="margin-bottom:2px;border:none;display:inline"></a><span style="white-space:nowrap"><img src="https://s3.amazonaws.com/htmlsig-assets/spacer.gif" width="2"></span> <a href="https://www.linkedin.com/profile/public-profile-settings?trk=prof-edit-edit-public_profile" style="display:inline;text-decoration:none" target="_blank"><img width="16" height="16" src="https://s3.amazonaws.com/htmlsig-assets/round/linkedin.png" alt="Linkedin" style="margin-bottom:2px;border:none;display:inline"></a><span style="white-space:nowrap"><img src="https://s3.amazonaws.com/htmlsig-assets/spacer.gif" width="2"></span> <a href="https://github.com/rg3915" style="display:inline;text-decoration:none" target="_blank"><img width="16" height="16" src="https://s3.amazonaws.com/htmlsig-assets/round/github.png" alt="github" style="margin-bottom:2px;border:none;display:inline"></a><span style="white-space:nowrap"><img src="https://s3.amazonaws.com/htmlsig-assets/spacer.gif" width="2"></span> <a href="http://grandeportal.github.io/" style="display:inline;text-decoration:none" target="_blank"><img width="16" height="16" src="https://raw.githubusercontent.com/grandeportal/grandeportal.github.io/master/img/matrix-icon.jpg" alt="matrix" style="margin-bottom:2px;border:none;display:inline"></a></p></td></tr></tbody></table></div></div></div>
<br><div class="gmail_quote">Em 21 de janeiro de 2016 21:35, Régis Silva <span dir="ltr">&lt;<a href="mailto:regis.santos.100@gmail.com" target="_blank">regis.santos.100@gmail.com</a>&gt;</span> escreveu:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">OK. Fabio.<div><br></div><div>Mas porque eu não posso usar </div><span class=""><div><br></div><div><span style="font-family:monospace,monospace;font-size:12.8px">s = serializers.serialize(&#39;json&#39;, data)</span><br></div><div><span style="font-family:monospace,monospace;font-size:12.8px"><br></span></div></span><div><span style="font-size:12.8px"><font face="arial, helvetica, sans-serif">E o teste? Como se faz?</font></span></div><div><span style="font-size:12.8px"><font face="arial, helvetica, sans-serif"><br></font></span></div><div><span style="font-size:12.8px"><font face="arial, helvetica, sans-serif">Arrumei meu código, ficou assim:</font></span></div><div><span style="font-size:12.8px"><font face="arial, helvetica, sans-serif"><br></font></span></div><div><div><span class=""><div><font face="monospace, monospace">def paid_list_json(request):</font></div><div><font face="monospace, monospace">    &#39;&#39;&#39; JSON used to generate the graphic &#39;&#39;&#39;</font></div><div><font face="monospace, monospace">    &#39;&#39;&#39; percent of paid &#39;&#39;&#39;</font></div></span><div><font face="monospace, monospace">    paid = Subscription.objects.filter(paid=True).count()</font></div><div><font face="monospace, monospace">    total = Subscription.objects.count()</font></div><div><font face="monospace, monospace">    paid_yes = int(paid * 100 / total)</font></div><div><font face="monospace, monospace">    paid_no = 100 - paid_yes</font></div><div><font face="monospace, monospace">    data = [{&#39;label&#39;: &#39;Sim&#39;, &#39;value&#39;: paid_yes},</font></div><div><font face="monospace, monospace">            {&#39;label&#39;: &#39;Não&#39;, &#39;value&#39;: paid_no},</font></div><div><font face="monospace, monospace">            ]</font></div><div><font face="monospace, monospace"><br></font></div><div><font face="monospace, monospace">    resp = JsonResponse(data, safe=False)</font></div><div><font face="monospace, monospace">    return HttpResponse(resp.content)</font></div></div></div><div><br></div><div><span style="font-family:monospace,monospace;font-size:12.8px"><br></span></div></div><div class="gmail_extra"><span class=""><br clear="all"><div><div><div dir="ltr"><table border="0" cellpadding="0" width="180" style="font-family:&#39;Times New Roman&#39;;table-layout:fixed"><tbody><tr><td align="left" valign="middle" width="80"><p style="margin-right:10px;font-family:Helvetica,Arial,sans-serif;font-size:10px;line-height:12px;margin-bottom:10px"><a href="http://eventex-regis.herokuapp.com/" style="text-decoration:none" target="_blank">EVENTEX </a><a href="https://github.com/rg3915/wttd2" style="display:inline;text-decoration:none" target="_blank"><img width="16" height="16" src="https://s3.amazonaws.com/htmlsig-assets/round/github.png" alt="github" style="margin-bottom:2px;border:none;display:inline"></a><span style="white-space:nowrap"><img src="https://s3.amazonaws.com/htmlsig-assets/spacer.gif" width="2"></span></p></td><td align="left" nowrap width="100"><p style="font-family:Helvetica,Arial,sans-serif;font-size:10px;line-height:12px;color:rgb(33,33,33);margin-bottom:10px"><span style="font-weight:bold;display:inline">Regis da Silva</span><br><span style="display:inline"></span><span style="display:inline">Web Developer</span><br><a href="http://grandeportal.github.io/" style="text-decoration:none" target="_blank">grandeportal.github.io</a> <span style="display:inline"><br></span></p><p style="font-size:0px;line-height:0;font-family:Helvetica,Arial,sans-serif"><a href="https://about.me/rg3915" style="display:inline;text-decoration:none" target="_blank"><img width="16" height="16" src="http://www.kevinpiersoul.com/assets/images/about-active.png" alt="Aboutme" style="margin-bottom:2px;border:none;display:inline"></a><span style="white-space:nowrap"><img src="https://s3.amazonaws.com/htmlsig-assets/spacer.gif" width="2"></span> <a href="https://www.linkedin.com/profile/public-profile-settings?trk=prof-edit-edit-public_profile" style="display:inline;text-decoration:none" target="_blank"><img width="16" height="16" src="https://s3.amazonaws.com/htmlsig-assets/round/linkedin.png" alt="Linkedin" style="margin-bottom:2px;border:none;display:inline"></a><span style="white-space:nowrap"><img src="https://s3.amazonaws.com/htmlsig-assets/spacer.gif" width="2"></span> <a href="https://github.com/rg3915" style="display:inline;text-decoration:none" target="_blank"><img width="16" height="16" src="https://s3.amazonaws.com/htmlsig-assets/round/github.png" alt="github" style="margin-bottom:2px;border:none;display:inline"></a><span style="white-space:nowrap"><img src="https://s3.amazonaws.com/htmlsig-assets/spacer.gif" width="2"></span> <a href="http://grandeportal.github.io/" style="display:inline;text-decoration:none" target="_blank"><img width="16" height="16" src="https://raw.githubusercontent.com/grandeportal/grandeportal.github.io/master/img/matrix-icon.jpg" alt="matrix" style="margin-bottom:2px;border:none;display:inline"></a></p></td></tr></tbody></table></div></div></div>
<br></span><div><div class="h5"><div class="gmail_quote">Em 21 de janeiro de 2016 21:02, Fabio C. Barrionuevo da Luz <span dir="ltr">&lt;<a href="mailto:bnafta@gmail.com" target="_blank">bnafta@gmail.com</a>&gt;</span> escreveu:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">Regis, apartir do Django 1.8, você pode usar JsonResponse em vez de json.dumps(data, cls=DjangoJSONEncoder)<br><br><a href="https://docs.djangoproject.com/en/1.9/ref/request-response/#jsonresponse-objects" target="_blank">https://docs.djangoproject.com/en/1.9/ref/request-response/#jsonresponse-objects</a><br><div><br></div><div><br></div><div><br></div></div><div class="gmail_extra"><br><div class="gmail_quote"><div><div>2016-01-21 19:41 GMT-03:00 Régis Silva <span dir="ltr">&lt;<a href="mailto:regis.santos.100@gmail.com" target="_blank">regis.santos.100@gmail.com</a>&gt;</span>:<br></div></div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div><div><div dir="ltr"><div>Como eu faço para criar um teste que retorne o seguinte json?</div><div><br></div><div># o teste deve retornar</div><div><br></div><div><font face="monospace, monospace">[{&quot;paid&quot;: false, &quot;value&quot;: 85}, {&quot;paid&quot;: true, &quot;value&quot;: 14}]</font></div><div><br></div><div><font face="monospace, monospace"># views.py</font></div><div><font face="monospace, monospace">import json</font></div><div><font face="monospace, monospace">from django.core import serializers</font></div><div><font face="monospace, monospace">from django.core.serializers.json import DjangoJSONEncoder</font></div><div><font face="monospace, monospace">from django.http import HttpResponse</font></div><div><font face="monospace, monospace">from django.db.models import Count</font></div><div><font face="monospace, monospace">from eventex.subscriptions.models import Subscription</font></div><div><font face="monospace, monospace"><br></font></div><div><font face="monospace, monospace"><br></font></div><div><font face="monospace, monospace">def paid_list_json(request):</font></div><div><font face="monospace, monospace">    &#39;&#39;&#39; JSON used to generate the graphic &#39;&#39;&#39;</font></div><div><font face="monospace, monospace">    &#39;&#39;&#39; percent of paid &#39;&#39;&#39;</font></div><div><font face="monospace, monospace">    paids = Subscription.objects.values(&#39;paid&#39;).annotate(</font></div><div><font face="monospace, monospace">        quant=Count(&#39;paid&#39;)).order_by(&#39;paid&#39;)</font></div><div><font face="monospace, monospace">    total_items = Subscription.objects.count()</font></div><div><font face="monospace, monospace">    data = [{&#39;paid&#39;: g[&#39;paid&#39;],</font></div><div><font face="monospace, monospace">             &#39;value&#39;: int(g[&#39;quant&#39;] * 100 / total_items)} for g in paids]</font></div><div><font face="monospace, monospace"><br></font></div><div><font face="monospace, monospace">    s = json.dumps(data, cls=DjangoJSONEncoder)</font></div><div><font face="monospace, monospace">    # s = serializers.serialize(&#39;json&#39;, data)</font></div><div><font face="monospace, monospace">    return HttpResponse(s)</font></div><div><br></div><div>E ainda, com</div><div><br></div><div><font face="monospace, monospace">s = json.dumps(data, cls=DjangoJSONEncoder)</font></div><div><br></div><div>mas com</div><div><br></div><div><font face="monospace, monospace">s = serializers.serialize(&#39;json&#39;, data)</font></div><div><br></div><div>Não funciona. Retorna</div><div><br></div><div><font face="monospace, monospace">AttributeError at /inscricao/json/</font></div><div><font face="monospace, monospace">&#39;dict&#39; object has no attribute &#39;_meta&#39;</font></div><div><br></div><div><div><div dir="ltr"><table border="0" cellpadding="0" width="180" style="font-family:&#39;Times New Roman&#39;;table-layout:fixed"><tbody><tr><td align="left" valign="middle" width="80"><p style="margin-right:10px;font-family:Helvetica,Arial,sans-serif;font-size:10px;line-height:12px;margin-bottom:10px"><a href="http://eventex-regis.herokuapp.com/" style="text-decoration:none" target="_blank">EVENTEX </a><a href="https://github.com/rg3915/wttd2" style="display:inline;text-decoration:none" target="_blank"><img width="16" height="16" src="https://s3.amazonaws.com/htmlsig-assets/round/github.png" alt="github" style="margin-bottom:2px;border:none;display:inline"></a><span style="white-space:nowrap"><img src="https://s3.amazonaws.com/htmlsig-assets/spacer.gif" width="2"></span></p></td><td align="left" nowrap width="100"><p style="font-family:Helvetica,Arial,sans-serif;font-size:10px;line-height:12px;color:rgb(33,33,33);margin-bottom:10px"><span style="font-weight:bold;display:inline">Regis da Silva</span><br><span style="display:inline"></span><span style="display:inline">Web Developer</span><br><a href="http://grandeportal.github.io/" style="text-decoration:none" target="_blank">grandeportal.github.io</a> <span style="display:inline"><br></span></p><p style="font-size:0px;line-height:0;font-family:Helvetica,Arial,sans-serif"><a href="https://about.me/rg3915" style="display:inline;text-decoration:none" target="_blank"><img width="16" height="16" src="http://www.kevinpiersoul.com/assets/images/about-active.png" alt="Aboutme" style="margin-bottom:2px;border:none;display:inline"></a><span style="white-space:nowrap"><img src="https://s3.amazonaws.com/htmlsig-assets/spacer.gif" width="2"></span> <a href="https://www.linkedin.com/profile/public-profile-settings?trk=prof-edit-edit-public_profile" style="display:inline;text-decoration:none" target="_blank"><img width="16" height="16" src="https://s3.amazonaws.com/htmlsig-assets/round/linkedin.png" alt="Linkedin" style="margin-bottom:2px;border:none;display:inline"></a><span style="white-space:nowrap"><img src="https://s3.amazonaws.com/htmlsig-assets/spacer.gif" width="2"></span> <a href="https://github.com/rg3915" style="display:inline;text-decoration:none" target="_blank"><img width="16" height="16" src="https://s3.amazonaws.com/htmlsig-assets/round/github.png" alt="github" style="margin-bottom:2px;border:none;display:inline"></a><span style="white-space:nowrap"><img src="https://s3.amazonaws.com/htmlsig-assets/spacer.gif" width="2"></span> <a href="http://grandeportal.github.io/" style="display:inline;text-decoration:none" target="_blank"><img width="16" height="16" src="https://raw.githubusercontent.com/grandeportal/grandeportal.github.io/master/img/matrix-icon.jpg" alt="matrix" style="margin-bottom:2px;border:none;display:inline"></a></p></td></tr></tbody></table></div></div></div><span><font color="#888888">
</font></span></div></div></div><span><font color="#888888">

<p></p>

-- <br>
Você recebeu essa mensagem porque está inscrito no grupo &quot;Welcome to the Django 2015&quot; dos Grupos do Google.<br>
Para cancelar inscrição nesse grupo e parar de receber e-mails dele, envie um e-mail para <a href="mailto:wttd-2015+unsubscribe@googlegroups.com" target="_blank">wttd-2015+unsubscribe@googlegroups.com</a>.<br>
Para postar nesse grupo, envie um e-mail para <a href="mailto:wttd-2015@googlegroups.com" target="_blank">wttd-2015@googlegroups.com</a>.<br>
Acesse esse grupo em <a href="https://groups.google.com/group/wttd-2015" target="_blank">https://groups.google.com/group/wttd-2015</a>.<br>
Para ver essa discussão na Web, acesse <a href="https://groups.google.com/d/msgid/wttd-2015/CA%2BDznZN9qBXuL-poj9xJtquf55_sGLq4ksVDCvqxSa%3DOdt4-Pw%40mail.gmail.com?utm_medium=email&amp;utm_source=footer" target="_blank">https://groups.google.com/d/msgid/wttd-2015/CA%2BDznZN9qBXuL-poj9xJtquf55_sGLq4ksVDCvqxSa%3DOdt4-Pw%40mail.gmail.com</a>.<br>
Para mais opções, acesse <a href="https://groups.google.com/d/optout" target="_blank">https://groups.google.com/d/optout</a>.<span><font color="#888888"><br>
</font></span></font></span></blockquote></div><span><font color="#888888"><br><br clear="all"><div><br></div>-- <br><div><div dir="ltr"><div><div dir="ltr"><div dir="ltr" style="font-family:arial;font-size:small">Fábio C. Barrionuevo da Luz<br>Palmas - Tocantins - Brasil - América do Sul<br><div><br></div><div><a href="http://pythonclub.com.br/" style="color:rgb(17,85,204)" target="_blank">http://pythonclub.com.br/</a></div><div><br></div><div><div>Blog colaborativo sobre Python e tecnologias Relacionadas, mantido totalmente no <a href="https://github.com/pythonclub/pythonclub.github.io" style="color:rgb(17,85,204)" target="_blank">https://github.com/pythonclub/pythonclub.github.io</a> .</div><div><br></div><div>Todos são livres para publicar. É só fazer fork, escrever sua postagem e mandar o pull-request. Leia mais sobre como publicar em README.md e <a href="http://contributing.md/" style="color:rgb(17,85,204)" target="_blank">contributing.md</a>.</div><div>Regra básica de postagem:</div><div>&quot;Você&quot; acha interessante? É útil para &quot;você&quot;? Pode ser utilizado com Python ou é útil para quem usa Python? Está esperando o que? Publica logo, que estou louco para ler...</div></div></div><div><div style="font-family:arial;font-size:small"><div><br></div></div></div></div></div></div></div>
</font></span></div><span><font color="#888888">

<p></p>

-- <br>
Você recebeu essa mensagem porque está inscrito no grupo &quot;Welcome to the Django 2015&quot; dos Grupos do Google.<br>
Para cancelar inscrição nesse grupo e parar de receber e-mails dele, envie um e-mail para <a href="mailto:wttd-2015+unsubscribe@googlegroups.com" target="_blank">wttd-2015+unsubscribe@googlegroups.com</a>.<br>
Para postar nesse grupo, envie um e-mail para <a href="mailto:wttd-2015@googlegroups.com" target="_blank">wttd-2015@googlegroups.com</a>.<br>
Acesse esse grupo em <a href="https://groups.google.com/group/wttd-2015" target="_blank">https://groups.google.com/group/wttd-2015</a>.<br>
Para ver essa discussão na Web, acesse <a href="https://groups.google.com/d/msgid/wttd-2015/CAPVjvMaTskzo%2BH231c%2Bssf3X%2Bum1Yft-TswvRUKxLwfCnEiuKw%40mail.gmail.com?utm_medium=email&amp;utm_source=footer" target="_blank">https://groups.google.com/d/msgid/wttd-2015/CAPVjvMaTskzo%2BH231c%2Bssf3X%2Bum1Yft-TswvRUKxLwfCnEiuKw%40mail.gmail.com</a>.<br>
Para mais opções, acesse <a href="https://groups.google.com/d/optout" target="_blank">https://groups.google.com/d/optout</a>.<br>
</font></span></blockquote></div><br></div></div></div>
</blockquote></div><br></div>

<p></p>

-- <br />
Você recebeu essa mensagem porque está inscrito no grupo &quot;Welcome to the Django 2015&quot; dos Grupos do Google.<br />
Para cancelar inscrição nesse grupo e parar de receber e-mails dele, envie um e-mail para <a href="mailto:wttd-2015+unsubscribe@googlegroups.com">wttd-2015+unsubscribe@googlegroups.com</a>.<br />
Para postar nesse grupo, envie um e-mail para <a href="mailto:wttd-2015@googlegroups.com">wttd-2015@googlegroups.com</a>.<br />
Acesse esse grupo em <a href="https://groups.google.com/group/wttd-2015">https://groups.google.com/group/wttd-2015</a>.<br />
Para ver essa discussão na Web, acesse <a href="https://groups.google.com/d/msgid/wttd-2015/CA%2BDznZMqZ7ifBwtcB1kgHOS4mSqD_1%2Bpjh6BoQfh0bz8wnU5vg%40mail.gmail.com?utm_medium=email&utm_source=footer">https://groups.google.com/d/msgid/wttd-2015/CA%2BDznZMqZ7ifBwtcB1kgHOS4mSqD_1%2Bpjh6BoQfh0bz8wnU5vg%40mail.gmail.com</a>.<br />
Para mais opções, acesse <a href="https://groups.google.com/d/optout">https://groups.google.com/d/optout</a>.<br />
