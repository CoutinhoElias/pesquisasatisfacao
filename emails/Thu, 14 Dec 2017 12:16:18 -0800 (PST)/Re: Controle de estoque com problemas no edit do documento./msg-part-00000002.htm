<div dir="ltr">O que o Fred disse está correto. O mais certo seria sobrescrever o método Save.<div><br></div><div>Se quiser manter do jeito que está agora, você precisa levar em consideração que o post_save será executado sempre que uma instância do model for salva, seja uma instância nova ou uma edição. O parâmetro &quot;created&quot; do post_save serve para isto. Ele será True se for uma nova instância. Você pode basear a lógica da atualização do saldo neste parâmetro. Veja a documentação do post_save: https://docs.djangoproject.com/en/dev/ref/signals/#post-save</div><div><br></div><div>E se você quiser permitir alterações de quantidade, e fazer com que isto se reflita no cálculo do estoque, você precisa copiar o valor original do atributo &quot;quantity&quot; no __init__ do model, para ter este valor disponível no post_save.</div><div><br></div><div>Então basicamente:</div><div><br></div><div>- No __init__ do model acrescente algo como &quot;self.original_quantity = self.quantity&quot;, depois do super().__init__()</div><div>- Modifique seu post_save para algo assim:</div><div><br></div><div>if created:</div><div><span style="background-color: rgb(255, 251, 221); color: rgb(36, 41, 46); font-family: SFMono-Regular, Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 12px; white-space: pre;">  </span><span style="color: rgb(36, 41, 46); font-family: SFMono-Regular, Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 12px; white-space: pre; background-color: rgb(255, 251, 221);">instance.title.stock </span><span class="pl-k" style="box-sizing: border-box; color: rgb(215, 58, 73); font-family: SFMono-Regular, Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 12px; white-space: pre;">-=</span><span style="color: rgb(36, 41, 46); font-family: SFMono-Regular, Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 12px; white-space: pre; background-color: rgb(255, 251, 221);"> instance.quantity</span></div><div><span style="color: rgb(36, 41, 46); font-family: SFMono-Regular, Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 12px; white-space: pre; background-color: rgb(255, 251, 221);">else:</span></div><div><span style="color: rgb(36, 41, 46); font-family: SFMono-Regular, Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 12px; white-space: pre; background-color: rgb(255, 251, 221);">  instance.title.stock = </span><span style="background-color: rgb(255, 251, 221); color: rgb(36, 41, 46); font-family: SFMono-Regular, Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 12px; white-space: pre;">instance.title.stock + instance.original_quantity - instance.quantity</span></div><div><span style="background-color: rgb(255, 251, 221); color: rgb(36, 41, 46); font-family: SFMono-Regular, Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 12px; white-space: pre;"><br></span></div><div><span style="background-color: rgb(255, 251, 221); color: rgb(36, 41, 46); font-family: SFMono-Regular, Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 12px; white-space: pre;"><br></span></div><div><br><br>On Thursday, December 14, 2017 at 3:14:35 PM UTC-2, Elias Coutinho wrote:<blockquote class="gmail_quote" style="margin: 0;margin-left: 0.8ex;border-left: 1px #ccc solid;padding-left: 1ex;"><div dir="ltr">Entendido Fred, meu problema é que possuo dois modelos, Item que é onde eu lanço a quantidade e o Papel que de fatoé onde fica a quantidade em estoque.<div><br></div><div>Se eu sobrescrever o save do modelo Item, como terei acesso ao modelo Papel e vice versa?</div><div>O problema é conceitual, não sei como proceder nesse caso.</div><div><br></div><div>Aquele exemplo que me mostrou serviu para resolver muita coisa, contudo esbarrei neste aqui.</div></div><div><br><div class="gmail_quote">Em 14 de dezembro de 2017 14:08, Fred Chevitarese <span dir="ltr">&lt;<a href="javascript:" target="_blank" gdf-obfuscated-mailto="dNm3DDg2BAAJ" rel="nofollow" onmousedown="this.href=&#39;javascript:&#39;;return true;" onclick="this.href=&#39;javascript:&#39;;return true;">fchevi...@gmail.com</a>&gt;</span> escreveu:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr"><div style="font-family:tahoma,sans-serif;font-size:small">Acho que é por causa do post_save. </div><div style="font-family:tahoma,sans-serif;font-size:small"><br></div><div style="font-family:tahoma,sans-serif;font-size:small">Acho que tudo isso aí deveria ser feito sobrescrevendo o método save do modelo. <br></div><div style="font-family:tahoma,sans-serif;font-size:small"><br></div><div style="font-family:tahoma,sans-serif;font-size:small"><br></div><div style="font-family:tahoma,sans-serif;font-size:small">Abraço!</div></div><div><br clear="all"><div><div><div dir="ltr"><div><span style="border-collapse:collapse"><font face="tahoma, sans-serif" size="1"><div style="color:rgb(32,32,32);text-align:justify"><br></div><div style="color:rgb(32,32,32);text-align:justify"><br></div><div style="color:rgb(32,32,32);text-align:justify"><b>&quot;</b></div></font><font face="trebuchet ms, sans-serif" size="1"><b><i>São os homens que mais me surpreendem na humanidade. Porque perdem a saúde para juntar dinheiro, depois perdem dinheiro para recuperar a saúde. E por pensarem ansiosamente no futuro, esquecem do presente de tal forma que acabam por não viver nem o presente nem o futuro. E vivem como se nunca fossem morrer e morrem como se nunca tivessem vivido” - Dalai Lama.</i></b></font><font face="tahoma, sans-serif" size="1"><div style="color:rgb(32,32,32);text-align:justify"><span><b>&quot;</b></span></div></font></span></div><font face="tahoma, sans-serif" size="1"><br></font><div><font face="tahoma, sans-serif" size="1"><b>Fred Chevitarese - GNU/Linux</b></font></div><div><a href="http://chevitarese.wordpress.com" target="_blank" rel="nofollow" onmousedown="this.href=&#39;http://www.google.com/url?q\x3dhttp%3A%2F%2Fchevitarese.wordpress.com\x26sa\x3dD\x26sntz\x3d1\x26usg\x3dAFQjCNEJq2Rmvs9MlTI6Nuk5eyJbAUjZTg&#39;;return true;" onclick="this.href=&#39;http://www.google.com/url?q\x3dhttp%3A%2F%2Fchevitarese.wordpress.com\x26sa\x3dD\x26sntz\x3d1\x26usg\x3dAFQjCNEJq2Rmvs9MlTI6Nuk5eyJbAUjZTg&#39;;return true;"><font face="tahoma, sans-serif" size="1"><b>http://chevitarese.wordpress.<wbr>com</b></font></a></div><div><br></div><div><span style="font-family:&#39;Droid Sans&#39;,arial,sans-serif;font-size:13px;border-collapse:collapse;color:rgb(32,32,32)"><div style="text-align:justify"><br></div></span></div></div></div></div><div><div>
<br><div class="gmail_quote">Em 14 de dezembro de 2017 15:05, Elias Coutinho <span dir="ltr">&lt;<a href="javascript:" target="_blank" gdf-obfuscated-mailto="dNm3DDg2BAAJ" rel="nofollow" onmousedown="this.href=&#39;javascript:&#39;;return true;" onclick="this.href=&#39;javascript:&#39;;return true;">coutinh...@gmail.com</a>&gt;</span> escreveu:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">Somente o virtualenv com python3 e instale o requirements.txt<div><br></div></div><div><br><div class="gmail_quote"><div><div>Em 14 de dezembro de 2017 12:59, willian firmino <span dir="ltr">&lt;<a href="javascript:" target="_blank" gdf-obfuscated-mailto="dNm3DDg2BAAJ" rel="nofollow" onmousedown="this.href=&#39;javascript:&#39;;return true;" onclick="this.href=&#39;javascript:&#39;;return true;">willian....@gmail.com</a>&gt;</span> escreveu:<br></div></div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div><div><div dir="ltr">gostaria de ver este projeto rodando, o que tenho que configurar?<br></div><div><br><div class="gmail_quote"><span>2017-12-13 18:59 GMT-02:00 Elias Coutinho <span dir="ltr">&lt;<a href="javascript:" target="_blank" gdf-obfuscated-mailto="dNm3DDg2BAAJ" rel="nofollow" onmousedown="this.href=&#39;javascript:&#39;;return true;" onclick="this.href=&#39;javascript:&#39;;return true;">coutinh...@gmail.com</a>&gt;</span>:<br></span><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><span><div dir="ltr"><div>Boa tarde pessoal.</div><div>Estou tentando implementar um controle de estoque.</div><div>Por enquanto estou apenas nas movimentações de saída.</div><div>Quando eu emito um invoice ele corretamente dá a saída do estoque conforme código no models abaixo:</div><div>Inclusive ele verifica se o estoque vai ficar negativo e avisa!</div><div><br></div><div><a href="https://github.com/CoutinhoElias/danibraz/blob/master/danibraz/checkout/models.py#L137-L163" target="_blank" rel="nofollow" onmousedown="this.href=&#39;https://www.google.com/url?q\x3dhttps%3A%2F%2Fgithub.com%2FCoutinhoElias%2Fdanibraz%2Fblob%2Fmaster%2Fdanibraz%2Fcheckout%2Fmodels.py%23L137-L163\x26sa\x3dD\x26sntz\x3d1\x26usg\x3dAFQjCNFw9bCi2RjP1DifEtkLJtG8ljQKvQ&#39;;return true;" onclick="this.href=&#39;https://www.google.com/url?q\x3dhttps%3A%2F%2Fgithub.com%2FCoutinhoElias%2Fdanibraz%2Fblob%2Fmaster%2Fdanibraz%2Fcheckout%2Fmodels.py%23L137-L163\x26sa\x3dD\x26sntz\x3d1\x26usg\x3dAFQjCNFw9bCi2RjP1DifEtkLJtG8ljQKvQ&#39;;return true;">https://github.com/<wbr>CoutinhoElias/danibraz/blob/<wbr>master/danibraz/checkout/<wbr>models.py#L137-L163</a></div><div><br></div><div>O problema é quando editamos um documento, ele faz o processo acima novamente, ou seja, dá a saída novamente com novos valores. Isso ta errado! Deveria fazer uma análise da quantidade antes de salvar o estoque e dependendo do valor editado ele deveria adicionar ou remover do estoque. </div><div>Exemplo:</div><div><br></div><div>Na tabela Papel existe um campo chamado stock, conforme abaixo:</div><div><a href="https://github.com/CoutinhoElias/danibraz/blob/master/danibraz/checkout/models.py#L105-L116" target="_blank" rel="nofollow" onmousedown="this.href=&#39;https://www.google.com/url?q\x3dhttps%3A%2F%2Fgithub.com%2FCoutinhoElias%2Fdanibraz%2Fblob%2Fmaster%2Fdanibraz%2Fcheckout%2Fmodels.py%23L105-L116\x26sa\x3dD\x26sntz\x3d1\x26usg\x3dAFQjCNF7rVkHcWdNYx1zMRJffNwcuONiHw&#39;;return true;" onclick="this.href=&#39;https://www.google.com/url?q\x3dhttps%3A%2F%2Fgithub.com%2FCoutinhoElias%2Fdanibraz%2Fblob%2Fmaster%2Fdanibraz%2Fcheckout%2Fmodels.py%23L105-L116\x26sa\x3dD\x26sntz\x3d1\x26usg\x3dAFQjCNF7rVkHcWdNYx1zMRJffNwcuONiHw&#39;;return true;">https://github.com/<wbr>CoutinhoElias/danibraz/blob/<wbr>master/danibraz/checkout/<wbr>models.py#L105-L116</a> </div><div><br></div><div>Lá consta meu cadastro de produtos e minha quantidade em estoque de cada um deles.</div><div><br></div><div>Na tabela Item constamos itens de um documento de saída conforme postei no início.</div><div>Quando um item é salvo no banco de dados um signals é disparado e dou saída do estoque do produto que preenchi no campo title, isso ta lindo! Funcionando!</div><div><br></div><div>O problema é quando vou editar esse documento, ele no lugar de atualizar a diferença na quantidade de estoque da tabela Papel ele dá saída novamente!</div><div>Falei com um amigo e ele pediu para mostrar isso no fórum e ainda disse que o problema pode ser minha view do updade, então abaixo estão as duas views para os senhores tentarem identificar algum bug, pois já pesquisei em vários locais e não achei nada. </div><div><br></div><div><a href="https://github.com/CoutinhoElias/danibraz/blob/master/danibraz/checkout/views.py#L14-L54" target="_blank" rel="nofollow" onmousedown="this.href=&#39;https://www.google.com/url?q\x3dhttps%3A%2F%2Fgithub.com%2FCoutinhoElias%2Fdanibraz%2Fblob%2Fmaster%2Fdanibraz%2Fcheckout%2Fviews.py%23L14-L54\x26sa\x3dD\x26sntz\x3d1\x26usg\x3dAFQjCNGB3a23Rp5HArJoilLUsw0S5l2Ajw&#39;;return true;" onclick="this.href=&#39;https://www.google.com/url?q\x3dhttps%3A%2F%2Fgithub.com%2FCoutinhoElias%2Fdanibraz%2Fblob%2Fmaster%2Fdanibraz%2Fcheckout%2Fviews.py%23L14-L54\x26sa\x3dD\x26sntz\x3d1\x26usg\x3dAFQjCNGB3a23Rp5HArJoilLUsw0S5l2Ajw&#39;;return true;">https://github.com/<wbr>CoutinhoElias/danibraz/blob/<wbr>master/danibraz/checkout/<wbr>views.py#L14-L54</a></div><div><br></div><div>Obrigado.</div></div></span><span><font color="#888888"><span><font color="#888888">

<p></p>

-- <br>
Você recebeu essa mensagem porque está inscrito no grupo &quot;Django Brasil&quot; dos Grupos do Google.<br>
Para cancelar inscrição nesse grupo e parar de receber e-mails dele, envie um e-mail para <a href="javascript:" target="_blank" gdf-obfuscated-mailto="dNm3DDg2BAAJ" rel="nofollow" onmousedown="this.href=&#39;javascript:&#39;;return true;" onclick="this.href=&#39;javascript:&#39;;return true;">django-brasi...@<wbr>googlegroups.com</a>.</font></span><span><br>
Para mais opções, acesse <a href="https://groups.google.com/d/optout" target="_blank" rel="nofollow" onmousedown="this.href=&#39;https://groups.google.com/d/optout&#39;;return true;" onclick="this.href=&#39;https://groups.google.com/d/optout&#39;;return true;">https://groups.google.com/d/<wbr>optout</a>.<br>
</span></font></span></blockquote></div><br></div></div></div><div><div>

<p></p>

-- <br>
Você recebeu essa mensagem porque está inscrito em um tópico no grupo &quot;Django Brasil&quot; dos Grupos do Google.<br>
Para cancelar inscrição nesse tópico, acesse <a href="https://groups.google.com/d/topic/django-brasil/OvuWra_QpRE/unsubscribe" target="_blank" rel="nofollow" onmousedown="this.href=&#39;https://groups.google.com/d/topic/django-brasil/OvuWra_QpRE/unsubscribe&#39;;return true;" onclick="this.href=&#39;https://groups.google.com/d/topic/django-brasil/OvuWra_QpRE/unsubscribe&#39;;return true;">https://groups.google.com/d/<wbr>topic/django-brasil/OvuWra_<wbr>QpRE/unsubscribe</a>.<br>
Para cancelar inscrição nesse grupo e todos os seus tópicos, envie um e-mail para <a href="javascript:" target="_blank" gdf-obfuscated-mailto="dNm3DDg2BAAJ" rel="nofollow" onmousedown="this.href=&#39;javascript:&#39;;return true;" onclick="this.href=&#39;javascript:&#39;;return true;">django-brasi...@<wbr>googlegroups.com</a>.<span><br>
Para mais opções, acesse <a href="https://groups.google.com/d/optout" target="_blank" rel="nofollow" onmousedown="this.href=&#39;https://groups.google.com/d/optout&#39;;return true;" onclick="this.href=&#39;https://groups.google.com/d/optout&#39;;return true;">https://groups.google.com/d/<wbr>optout</a>.<br>
</span></div></div></blockquote></div><span><font color="#888888"><br><br clear="all"><div><br></div>-- <br><div>Elias Coutinho.<br>Aprender sobre alguns assuntos é fundamental.<br>Aprender sobre Deus é indiscutivelmente o melhor conteúdo.</div>
</font></span></div><div><div>

<p></p>

-- <br>
Você recebeu essa mensagem porque está inscrito no grupo &quot;Django Brasil&quot; dos Grupos do Google.<br>
Para cancelar inscrição nesse grupo e parar de receber e-mails dele, envie um e-mail para <a href="javascript:" target="_blank" gdf-obfuscated-mailto="dNm3DDg2BAAJ" rel="nofollow" onmousedown="this.href=&#39;javascript:&#39;;return true;" onclick="this.href=&#39;javascript:&#39;;return true;">django-brasi...@<wbr>googlegroups.com</a>.<br>
Para mais opções, acesse <a href="https://groups.google.com/d/optout" target="_blank" rel="nofollow" onmousedown="this.href=&#39;https://groups.google.com/d/optout&#39;;return true;" onclick="this.href=&#39;https://groups.google.com/d/optout&#39;;return true;">https://groups.google.com/d/<wbr>optout</a>.<br>
</div></div></blockquote></div><br></div></div></div><div><div>

<p></p>

-- <br>
Você recebeu essa mensagem porque está inscrito em um tópico no grupo &quot;Django Brasil&quot; dos Grupos do Google.<br>
Para cancelar inscrição nesse tópico, acesse <a href="https://groups.google.com/d/topic/django-brasil/OvuWra_QpRE/unsubscribe" target="_blank" rel="nofollow" onmousedown="this.href=&#39;https://groups.google.com/d/topic/django-brasil/OvuWra_QpRE/unsubscribe&#39;;return true;" onclick="this.href=&#39;https://groups.google.com/d/topic/django-brasil/OvuWra_QpRE/unsubscribe&#39;;return true;">https://groups.google.com/d/<wbr>topic/django-brasil/OvuWra_<wbr>QpRE/unsubscribe</a>.<br>
Para cancelar inscrição nesse grupo e todos os seus tópicos, envie um e-mail para <a href="javascript:" target="_blank" gdf-obfuscated-mailto="dNm3DDg2BAAJ" rel="nofollow" onmousedown="this.href=&#39;javascript:&#39;;return true;" onclick="this.href=&#39;javascript:&#39;;return true;">django-brasi...@<wbr>googlegroups.com</a>.<br>
Para mais opções, acesse <a href="https://groups.google.com/d/optout" target="_blank" rel="nofollow" onmousedown="this.href=&#39;https://groups.google.com/d/optout&#39;;return true;" onclick="this.href=&#39;https://groups.google.com/d/optout&#39;;return true;">https://groups.google.com/d/<wbr>optout</a>.<br>
</div></div></blockquote></div><br><br clear="all"><div><br></div>-- <br><div>Elias Coutinho.<br>Aprender sobre alguns assuntos é fundamental.<br>Aprender sobre Deus é indiscutivelmente o melhor conteúdo.</div>
</div>
</blockquote></div></div>

<p></p>

-- <br />
Você recebeu essa mensagem porque está inscrito em um tópico no grupo &quot;Django Brasil&quot; dos Grupos do Google.<br />
Para cancelar inscrição nesse tópico, acesse <a href="https://groups.google.com/d/topic/django-brasil/OvuWra_QpRE/unsubscribe">https://groups.google.com/d/topic/django-brasil/OvuWra_QpRE/unsubscribe</a>.<br />
Para cancelar inscrição nesse grupo e todos os seus tópicos, envie um e-mail para <a href="mailto:django-brasil+unsubscribe@googlegroups.com">django-brasil+unsubscribe@googlegroups.com</a>.<br />
Para mais opções, acesse <a href="https://groups.google.com/d/optout">https://groups.google.com/d/optout</a>.<br />
